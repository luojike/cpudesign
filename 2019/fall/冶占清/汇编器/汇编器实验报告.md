# 汇编器实验报告

班级：智能1602

学号：201608010629

姓名：冶占清

## 实验目标

设计一个RISC-V基本整数指令汇编器，能够实现将汇编指令转化为二进制

## 实验要求

- 使用python编写汇编器代码
- 汇编器的输入是进行模拟的汇编指令
- 汇编器的输出是经过汇编后的二进制指令文件

## 实验内容

### 汇编器简介

> 汇编器是将汇编语言翻译为机器语言的程序。一般而言，汇编生成的是目标代码，需要经链接器生成可执行代码才可以执行

> 汇编语言是一种以处理器指令系统为基础的低级语言，采用助记符表达指令操作码，采用标识符表示指令操作数。作为一门语言，对应于高级语言的编译器，需要一个汇编器将汇编语言原文件汇编成机器可执行的代码

### RISC-V指令集介绍

**RV32I指令集包含了六种基本指令格式，分别是：**

R类型指令：用于寄存器到寄存器操作

I类型指令：用于短立即数和访存load操作

S类型指令：用于访存store操作

B类型指令：用于条件跳转操作

U类型指令：用于长立即数

J类型指令：用于无条件跳转

**RISC-V指令集编码格式**

![](./RV32I.PNG)

**RISC-V指令**

![](./RV32_1.PNG)

![](./RV32_2.PNG)

## 汇编器设计框架

整个汇编器的框架设计如下：
```cpp
/ <标号>: add x1, x2, x3
// <标号>:
// 10101010101101001

// 汇编程序文件 file.asm
// 一行一个汇编语句

// 初始化地址计数器 addr_counter = 0;
// while(file.asm没有到文件尾) {
  // 读入一行
  // while(读入的是纯标号且不是文件尾) { 继续读一行 }

  // 拆开行，得到标号（有可能没有），操作码或者伪指令助记符，操作数

  // if(有标号) { 记下标号和当前地址计数器的值，保存到符号表；
                  // 查看未决汇编语句是否需要这个标号，并解决
                }

  // if(操作码助记符) { 
        // 生成操作码编码;
        // 操作数 -> 寄存器编号或者立即数
        // if(操作数是标号) { 查找符号表，如果查到，计算得到偏移量；
                       // 如果没查到，记下当前汇编语句和地址
           }

        // 生成指令的二进制表示 }
  // else(伪指令助记符) { 根据伪指令含义执行相应转换 }

}
```
